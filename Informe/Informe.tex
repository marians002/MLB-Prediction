\documentclass{article}
\usepackage{graphicx}
\usepackage{amsmath, stackrel, amssymb}
\usepackage{mathtools}
\usepackage{scrextend}
\usepackage{xcolor}
\usepackage[a4paper, top=15mm, bottom=20mm]{geometry}
\title{Proyecto de Simulación	
    \\
    \large Predicción de resultados en la MLB}

\author{Alejandro Álvarez Lamazares - C311
\\
        Marian S. Álvarez Suri - C312
        \\
        Carlos A. Bresó Sotto - C312}
\date{}

\begin{document}
    \maketitle
    \large

    \section{Introducción}

        \subsection{Breve descripción del proyecto}
            Este proyecto tiene como objetivo utilizar una simulación de eventos discretos y el análisis de una tabla de estadísticas de la Major League Baseball (MLB) para predecir los resultados de la segunda mitad del campeonato. Se busca anticipar el clasificador final de la tabla de posiciones basándose exclusivamente en los datos disponibles hasta ese momento.

        \subsection{Objetivos y metas}
            El propósito de este proyecto es aproximarse lo más posible al resultado factual de la temporada de la MLB. Se evaluará la precisión de las simulaciones utilizando los datos reales del problema como base.

        \subsection{Variables que describen el problema}
            Se realizará una simulación de la segunda mitad de la temporada de la MLB del año 2021, utilizando los resultados obtenidos en la primera mitad. Se incorporarán variables adicionales, como las posibles lesiones de jugadores, que podrían influir en el desenlace de cada partido.

    \section{Detalles de implementación}

        El código comienza importando las bibliotecas necesarias: pandas para el manejo de datos, random para la generación de números aleatorios y numpy para las operaciones matemáticas.

        A continuación, se explicará el código por funciones:

        \begin{itemize}
            \item[\checkmark] \textbf{\textcolor{blue}{load\_data(filename)}}: Se utiliza para cargar los datos necesarios para la simulación. La función toma un nombre de archivo como argumento y utiliza la biblioteca pandas para cargar los datos en un DataFrame.
            \item[\checkmark] \textbf{\textcolor{blue}{get\_history(team1, team2, results)}}: devuelve el número de partidos jugados y ganados entre dos equipos.
            \item[\checkmark] \textbf{\textcolor{blue}{simulate\_injured\_players(p=0.5)}}: simula si hay jugadores lesionados en un equipo, utilizando una distribución binomial con $p = 0.5$, donde $p$ es la probabilidad de éxito.
            \item[\checkmark] \textbf{\textcolor{blue}{simulate\_game(team1, team2, results, game\_simulations)}}: simula un partido entre dos equipos basándose en los resultados históricos y en la posibilidad de que haya jugadores lesionados. Para esto, se calcula una tasa llamada "win\_rate", que se utiliza en una simulación de Monte Carlo para estimar el ganador del partido.
            \item[\checkmark] \textbf{\textcolor{blue}{simulate\_season(statistics, game\_simulations, count)}}: simula una temporada completa, haciendo que cada equipo juegue contra todos los demás. Por cada par de equipos, se simula el juego y se guardan los resultados.
            \item[\checkmark] \textbf{\textcolor{blue}{create\_results\_table(total\_wins)}}: convierte los resultados de la simulación en un DataFrame de pandas y lo ordena por el número total de victorias.
            \item[\checkmark] \textbf{\textcolor{blue}{create\_histogram(statistics, total\_spots, n)}}: Genera un histograma que representa la frecuencia de cada posición (spot) para los primeros $n$ equipos seleccionados.
            \item[\checkmark] \textbf{\textcolor{blue}{get\_sim\_results(epsilon, game\_simulations=100, show\_table=False, show\_histogram=True, num\_teams=5)}}: Realiza simulaciones de juegos con varios equipos y recopila los resultados. El parámetro 'epsilon' controla qué tanto tiempo estará ejecutándose la simulación según la desviación estándar de la distribución normal.
            \item[\checkmark] \textbf{\textcolor{blue}{get\_real\_results()}}: Obtiene los resultados reales de los juegos en un rango de tiempo determinado a partir de las estadísticas de la MLB.
            \item[\checkmark] \textbf{\textcolor{blue}{position\_distances(df\_real, df\_simulated)}}: Calcula la distancia promedio entre las posiciones reales y simuladas de cada equipo a lo largo de varias ejecuciones. La distancia se calcula como la diferencia absoluta entre las posiciones reales y simuladas.
            \item[\checkmark] \textbf{\textcolor{blue}{exact\_positions(df\_real, df\_simulated)}}: Calcula el número de equipos que tienen la misma posición en los resultados reales y simulados creando una nueva columna que es Verdadera cuando las posiciones son las mismas y Falsa en caso contrario.
            \item[\checkmark] \textbf{\textcolor{blue}{top\_n(df\_real, df\_simulated, n)}}: Cuenta cuántos de los primeros $n$ equipos coinciden en sus posiciones en los resultados reales y simulados. 
            \item[\checkmark] \textbf{\textcolor{blue}{spearman\_correlation(df\_real, df\_simulated)}}: Calcula la correlación de Spearman entre las posiciones reales y simuladas de cada equipo.
            \item[\checkmark] \textbf{\textcolor{blue}{print\_results(num\_simulations, game\_simulations)}}: Ejecuta todo el proceso varias veces y devuelve la distancia media entre las posiciones reales y simuladas de los equipos.
            \item[\checkmark] \textbf{\textcolor{blue}{run\_simulation(epsilon, game\_simulations, show\_table=False)}}: Ejecuta una simulación de juegos y compara los resultados de la simulación con los resultados reales. Se obtienen los resultados reales con \textit{get\_real\_results()}. Luego, obtiene los resultados simulados llamando a \textit{get\_sim\_results(epsilon, game\_simulations, show\_table, True)}. Después de obtener los resultados reales y simulados, calcula la distancia de las posiciones entre ellos, el número de posiciones exactas, el número de equipos en las primeras $n$ posiciones que coinciden en los resultados reales y simulados, y la correlación de Spearman entre las posiciones reales y simuladas. Finalmente, devuelve una lista con estos cuatro resultados.
        \end{itemize}

    \section{Resultados y experimentos}
        La simulación realizada ha mostrado una notable coincidencia con los resultados finales de la temporada observada. A continuación, se presenta una representación gráfica que ilustra la comparación entre los datos reales y los obtenidos a través de la simulación.

        \subsection{Hallazgos de la simulación}

        \subsection{Interpretación de los resultados}
            Para profundizar en la comparación entre los datos reales y los simulados, se aplica la función calculate\_position\_distances(df\_real, df\_simulated). Esta herramienta permite identificar y cuantificar las diferencias entre ambos conjuntos de datos, ofreciendo una visión clara sobre la precisión de la simulación.

        \subsection{Hipótesis extraídas de los resultados}
            Basándose en los hallazgos obtenidos, se puede formular la hipótesis de que, mediante el uso de simulaciones, es factible predecir con un alto grado de precisión el resultado final de la tabla de posiciones de una temporada de la Major League Baseball, incluso antes de su conclusión. Esto subraya la utilidad de las simulaciones como herramientas predictivas en el ámbito deportivo, especialmente cuando se dispone de datos relevantes de la primera mitad de la temporada.

        \subsection{Experimentos realizados para validar las hipótesis}
            Se realizaron múltiples ejecuciones de la simulación con el objetivo de confirmar que los resultados obtenidos no sean el producto de circunstancias fortuitas o aleatorias, sino que reflejen una tendencia consistente y válida. Este enfoque metodológico permite establecer una mayor confianza en la precisión y fiabilidad de los hallazgos, al minimizar el riesgo de atribuir el éxito de la predicción a factores externos o a la casualidad.

            \textbf{Métricas empleadas:}
            Para validar los resultados empleamos varias métricas que explicaremos a continuación:

            \begin{itemize}
                \item \textbf{Distancia entre posiciones}: Indica la diferencia entre la posición real y la simulada de un equipo.
                \item \textbf{Posiciones exactas}: Muestra cuántas veces la simulación acertó la posición exacta de un equipo.
                \item \textbf{Top-n}: Indica cuántas veces la simulación acertó la posición de un equipo dentro de los primeros n lugares.
                \item \textbf{Correlación de Spearman}: Evalúa la relación entre las posiciones obtenidas en los resultados basándose en los rangos de los valores de las variables.                
            \end{itemize}

            
        \subsection{Necesidad de realizar el análisis estadístico de la simulación (Variables de interés)}

        \subsection{Análisis de parada de la simulación}
            Para determinar cuándo detener la simulación, es necesario establecer un criterio de parada que garantice la obtención de resultados precisos y confiables. En este caso, se optó por realizar múltiples ejecuciones de la simulación y calcular la distancia media entre las posiciones reales y simuladas de los equipos. Este enfoque permite evaluar la consistencia y estabilidad de los resultados, así como identificar posibles tendencias o patrones que puedan surgir a lo largo de las simulaciones.

\end{document}
